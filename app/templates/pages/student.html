{% extends 'pages/base.html' %} {% block title %}Trang chủ{% endblock %} {%
block content %}
<div class="row g-3 mb-4">
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <div class="d-flex align-items-center gap-3">
          <div class="rounded-3 p-3 bg-light">
            <i class="fa-solid fa-graduation-cap icon"></i>
          </div>
          <div>
            <div class="text-secondary small">Tổng số học sinh</div>
            <div class="fw-bold fs-5">{{ total_students }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% for classes in classrooms %}
  <div class="col-12 col-sm-6 col-lg-3">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-body">
        <div class="d-flex align-items-center gap-3">
          <div class="rounded-3 p-3 bg-light">
            <i class="fa-solid fa-seedling icon"></i>
          </div>
          <div>
            <div class="text-secondary small">{{ classes.name }}</div>
            <div class="fw-bold">
              {{ classroom_student_counts[classes.id] }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="card border-0 shadow-sm">
  <div class="card-body">
    <div
      class="d-flex flex-wrap gap-2 align-items-center justify-content-between mb-3"
    >
      <h5 class="mb-0">Danh sách học sinh</h5>
      <div class="d-flex gap-2">
        <div class="btn-group">
          <button
            class="btn btn-outline-secondary btn-sm dropdown-toggle"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            id="classFilterToggle"
          >
            Chọn lớp
          </button>
          <ul class="dropdown-menu" id="classFilter">
            <li>
              <a
                class="dropdown-item"
                href="javascript:void(0)"
                data-class="all"
                >Tất cả</a
              >
            </li>
            {% for classroom in classrooms %}
            <li>
              <a
                class="dropdown-item"
                href="javascript:void(0)"
                data-class="{{ classroom.id }}"
                >{{ classroom.name }}</a
              >
            </li>
            {% endfor %}
          </ul>
        </div>
        <form id="studentSearchForm">
          <div class="input-group input-group-sm">
            <span class="input-group-text bg-white">
              <i class="fa-solid fa-magnifying-glass icon"></i>
            </span>
            <input
              type="text"
              id="studentSearchInput"
              class="form-control"
              placeholder="Tìm kiếm học sinh"
              value="{{ request.args.get('q', '') }}"
            />
          </div>
        </form>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>STT</th>
            <th>Họ tên trẻ</th>
            <th>Ngày sinh</th>
            <th>Giới tính</th>
            <th>Lớp</th>
            <th>Phụ huynh</th>
            <th>Số điện thoại liên hệ</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="student_list">
          <!-- Dữ liệu sẽ được load từ API qua JavaScript -->
        </tbody>
      </table>
    </div>

    <div class="d-flex align-items-center justify-content-between pt-3">
      <button
        class="btn btn-sm rounded-circle btn-brand btn-fab"
        aria-label="Thêm"
        data-bs-toggle="modal"
        data-bs-target="#createStudentModal"
      >
        <i class="fa-solid fa-plus"></i>
      </button>
      <nav>
        <ul class="pagination pagination-sm mb-0" id="pagination">
          <li class="page-item" id="prevBtn">
            <a class="page-link" href="#" data-page="prev">‹</a>
          </li>
          <li class="page-item" id="nextBtn">
            <a class="page-link" href="#" data-page="next">›</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!--Modal chỉnh sửa học sinh-->
<div
  class="modal fade"
  id="editStudentModal"
  tabindex="-1"
  aria-labelledby="editStudentModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editStudentModalLabel">
          Chỉnh sửa học sinh
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="editStudentForm" class="vstack gap-3">
          <input type="hidden" id="editStudentId" />

          <div>
            <label for="editStudentName" class="form-label">Họ tên</label>
            <input type="text" class="form-control" id="editStudentName" />
          </div>

          <div>
            <label for="editStudentDob" class="form-label"
              >Ngày sinh (dd/mm/yyyy)</label
            >
            <input type="text" class="form-control" id="editStudentDob" />
          </div>

          <div>
            <label for="editStudentGender" class="form-label">Giới tính</label>
            <select class="form-select" id="editStudentGender">
              <option value="">-- Chọn giới tính --</option>
              <option value="Nam">Nam</option>
              <option value="Nữ">Nữ</option>
            </select>
          </div>

          <div>
            <label for="editStudentClassSelect" class="form-label">Lớp</label>
            <select class="form-select" id="editStudentClassSelect">
              <option value="">-- Chọn lớp --</option>
              {% for class in classrooms %}
              <option value="{{ class.id }}">{{ class.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="vstack gap-2">
            <div>
              <label for="editParentFilter" class="form-label">Phụ huynh</label>
              <input
                type="text"
                class="form-control"
                id="editParentFilter"
                placeholder="Nhập tên/số điện thoại để tìm"
                list="parentOptions"
              />
              <datalist id="parentOptions"></datalist>
            </div>
            <input type="hidden" id="editStudentParentId" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div
          class="me-auto text-danger small"
          id="editStudentError"
          aria-live="polite"
        ></div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Đóng
        </button>
        <button type="button" class="btn btn-primary" id="saveStudentBtn">
          Lưu
        </button>
      </div>
    </div>
  </div>
</div>

<!--Modal tạo học sinh mới-->
<div
  class="modal fade"
  id="createStudentModal"
  tabindex="-1"
  aria-labelledby="createStudentModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createStudentModalLabel">
          Thêm học sinh mới
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form id="createStudentForm" class="vstack gap-3">
          <div>
            <label for="createStudentName" class="form-label"
              >Họ tên <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              id="createStudentName"
              required
            />
          </div>

          <div>
            <label for="createStudentDob" class="form-label"
              >Ngày sinh (dd/mm/yyyy) <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              id="createStudentDob"
              placeholder="VD: 01/01/2020"
              required
            />
          </div>

          <div>
            <label for="createStudentGender" class="form-label"
              >Giới tính <span class="text-danger">*</span></label
            >
            <select class="form-select" id="createStudentGender" required>
              <option value="">-- Chọn giới tính --</option>
              <option value="Nam">Nam</option>
              <option value="Nữ">Nữ</option>
            </select>
          </div>

          <div>
            <label for="createStudentAddress" class="form-label"
              >Địa chỉ <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              id="createStudentAddress"
              required
            />
          </div>

          <div>
            <label for="createStudentClassSelect" class="form-label">Lớp</label>
            <select class="form-select" id="createStudentClassSelect">
              <option value="">-- Chọn lớp --</option>
              {% for class in classrooms %}
              <option value="{{ class.id }}">{{ class.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="vstack gap-2">
            <div>
              <label for="createParentFilter" class="form-label"
                >Phụ huynh</label
              >
              <input
                type="text"
                class="form-control"
                id="createParentFilter"
                placeholder="Nhập tên/số điện thoại để tìm"
                list="createParentOptions"
              />
              <datalist id="createParentOptions"></datalist>
            </div>
            <input type="hidden" id="createStudentParentId" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div
          class="me-auto text-danger small"
          id="createStudentError"
          aria-live="polite"
        ></div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Đóng
        </button>
        <button type="button" class="btn btn-primary" id="saveCreateStudentBtn">
          Thêm
        </button>
      </div>
    </div>
  </div>
</div>

<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
  crossorigin="anonymous"
></script>
<script src="{{ url_for('static', filename='Js/pagination.js') }}"></script>
<script src="{{ url_for('static', filename='Js/filters.js') }}"></script>
<script src="{{ url_for('static', filename='Js/student_page.js') }}"></script>
{% endblock %}
